name: Build Linux x86

agent:
  type: Unity::VM
  image: platform-foundation/linux-bokken:latest
  flavor: b1.large

commands:
  - sudo apt-get install -y mercurial
  - sudo apt-get install -y libfile-copy-recursive-perl
  - cp .yamato/config/hgrc ~/hgrc
  - cat ~/hgrc
  - sudo rm -rf /etc/mercurial/hgrc.d/hgext.rc
  - sudo cp .yamato/config/hgext.rc /etc/mercurial/hgrc.d/hgext.rc
  - cat /etc/mercurial/hgrc.d/hgext.rc
  - |
    cd ../..
    hg clone --uncompressed http://hg-mirror-slo.hq.unity3d.com/unity-extra/mono-build-deps/ mono-build-deps/build/
    cd mono-build-deps/build
    hg pull -r default
    hg up -C default
  - .yamato/scripts/build_linux_x86.sh

artifacts: 
  linux32:
    paths:
      - incomingbuilds/linux32/**
